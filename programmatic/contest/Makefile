#!/usr/bin/env make

include ../Makefile.defs

CSSFLAGS=-I../

all: usage contest

contest: wgo-contest.css contest_config.py contest.cgi gallery.cgi

wgo-contest.css: wgo-contest.cpp

usage:
	@if [ ${DocumentRoot} = "" ]; then echo "USAGE: make DocumentRoot=<DocumentRoot> install"; exit 1; fi

contest_config.py: Makefile ../Makefile.defs
	(echo "#!/usr/bin/env ${PYTHON}"               ; \
		echo "# THIS FILE IS AUTOMATICALLY GENERATED."               ; \
		echo "# DO NOT EDIT THIS FILE. See Makefile"                 ; \
	 echo "# By convention *_path variables contain the full pathnames of directories and/or files." ;\
	 echo "# By convention *_dir variables contain the pathnames of directories relative to ${DocumentRoot}." ;\
		echo ""                                                      ; \
	 echo "DocumentRoot='${DocumentRoot}'"                        ; \
	 echo "contest_dir='/contest/'"                               ; \
	 echo "contest_path=DocumentRoot + contest_dir"               ; \
	 echo "icon_dir='/contest/icons/'"                            ; \
	 echo "icon_path=DocumentRoot + icon_dir"                     ; \
	 echo "images_dir='/contest/images/'"                         ; \
	 echo "images_path=DocumentRoot + images_dir"                 ; \
		echo                                                         ; \
	 echo "# pathnames and directory names must end in a trailing /"                                                          ;\
	 echo "spool_dir='/var/wgo-contest/'            # relative to ${DocumentRoot} /"                                          ; \
	 echo "spool_path=DocumentRoot + spool_dir      # Full pathname of spool_dir"                                             ; \
		echo                                                                                                                     ; \
	 echo "gallery_dir='/var/wgo-contest-current/'  # directory, relative to ${DocumentRoot}, containing the current gallery" ; \
	 echo "gallery_path=DocumentRoot + gallery_dir"                                                                           ; \
	 echo "tmp_directory_ttl=60                     # minutes to wait for an image to be approved by the submitter"           ; \
	 echo "permission=0644                          # Unix mode bits to set on created files"                                 ; \
	 echo "debug=0"                                               ; \
	 echo "validator=0"                                           ; \
	 echo "datetime_format='%Y-%m-%d'"                            ; \
	) > contest_config.py

contest.cgi: contest.py

gallery.cgi: gallery.py

clean mrproper:
	/bin/rm -f *.pyc *.cgi wgo-contest.css contest_config.py *~

install: all
	install -m 755 -d ${LIBDIR}
	install -m 755 -d `${PYTHON} -c 'import contest_config; print contest_config.contest_path'`/include
	install -m 755 -d `${PYTHON} -c 'import contest_config; print contest_config.contest_path'`/icons
	install -m 755 -d `${PYTHON} -c 'import contest_config; print contest_config.contest_path'`/images
	install -m 755 -d `${PYTHON} -c 'import contest_config; print contest_config.icon_path'`
	if [ ! -d "`${PYTHON} -c 'import contest_config; print contest_config.spool_path'`" ]; then install -m 755 -d `${PYTHON} -c 'import contest_config; print contest_config.spool_path'`; fi
	if [ ! -d "`${PYTHON} -c 'import contest_config; print contest_config.gallery_path'`" ]; then install -m 755 -d `${PYTHON} -c 'import contest_config; print contest_config.gallery_path'`; fi

	install contest_config.py \
	        wgo_contest.py         ${LIBDIR}

	install images/gimp-splash.png \
	        images/gimp-bg.png     \
		images/gnome-final.png  `${PYTHON} -c 'import contest_config; print contest_config.images_path'`

	install wgo-contest.css \
	        contest.cgi     \
	        gallery.cgi     \
	        gimp-batch      \
	        index.html             `${PYTHON} -c 'import contest_config; print contest_config.contest_path'`
